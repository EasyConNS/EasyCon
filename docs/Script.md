## ecp脚本格式说明

>基于伊机控v1脚本格式发展而来，目的是在尽量兼容旧语法的基础上补充完善。
>v1脚本使用正则匹配每行脚本的格式，对脚本上下文支持不足，也不利于后续扩展。
>设计脚本规范后实现词法分析、语法分析、AST生成


按行分隔，每行作为一个表达式，无需特殊字符结尾

关键字，大小写忽略，但不可混用，格式化时统一大写

## 程序语法

### 声明语法

常量
"_"开头的为常量，必须先定义再使用。例：_测试时间=100

普通变量
`$`或`$$`开头的为变量。例：$1=1, $$test=233 

搜图变量，"@"开头的为搜图变量，只能出现在赋值右侧(兼容)。例：$1=@闪光度(当前为搜图专属，返回对应搜图匹配度结果，不排除后期扩展)

#定义变量/常量时可使用`,`分割在同一行同时定义多个变量/常量

### 数据类型

整数
-?\d+，暂时只支持整数，2字节或4字节（65,535、4,294,967,295）

字符串
//TODO

### 注释

单行注释
`#`字符开始其后直到行尾全部为注释内容。例：$a=1 #定义变量a内容为1

### 按键

- `A [50]`按下A键50ms，默认50ms(兼容)
- `A+L+R [100]`同时按下多个按键
- `HOME DOWN`(按住，需使用`HOME UP`松开)
- `<LS|RS> <RESET|UP|DOWNN|LEFT|RIGHT> [duringtime]`按照方向推左右摇杆,持续时间省略则保持，直到RESET
- `<LS|RS> <0-360>`按照角度推摇杆(兼容)

### 流程控制

#### 条件语句

语法
```
if 条件表达式
    代码块
#elif 条件表达式（可选）
    代码块
#else（可选）
    代码块
endif
```

#### 循环语句

语法
```
for #无限循环，需使用break跳出
    代码块
next
```
```
for 数字 #变量/常量/数字，开始循环后改变变量值循环次数不变
    代码块
next
```
```
for 变量 = 起始数字 to 结束数字 [step 步长]
    代码块
next
```
```
for 条件表达式 #每次循环前判断条件表达式是否为真，是则继续执行，否则退出循环
    代码块
next
```
```
    break #跳出循环，后接数字可指定跳出的层数（可选）
```
```
    continue #略过后续语句执行下一次循环（可选）
```

### 函数

语法
```
func 函数名(参数列表【可选】)
    代码块
#return 变量 //一个函数体中有且只能有一个return，且只能写在函数结尾（可选）
endfunc
```

### 规范

#### 关键字

if/elif/else/endif
for/to/step/next/break/continue
func/return/endfunc
A、B、X、Y、L、R、ZL、ZR
MINUS(-)、PLUS(+)、LCLICK(按左摇杆)、RCLICK(按右摇杆)、HOME(返回主页/游戏)、CAPTURE(截屏)
DLEFT、DRIGHT、DUP、DDOWN(DPAD方向键)

#### 运算符

- 算数符号：+-*/(整除)%(取余数)\(舍入除)
- 算数逻辑符号：&(与)|(或)^(异或)<</>>
- 算数赋值：+=、-=、*=、/=、%=(等价于`A=A[op]B`)
- 表达式逻辑符号：&&,||
- 单目运算符：~(非)
- 赋值：=
- 比较：<、>、<=、>=、!=、==(双等比较)
- 标点：()[]{},;:

#### 库函数

等待：按照关键字处理，但实现上应使用库来实现，与虚拟机实现分离
```
WAIT 数字 #脚本延时毫秒数，可选，默认50
```

输出：#V1虚拟机兼容语法，无法使用语法解析，进行特殊处理（或者设计不兼容语法？）
```
PRINT 输出内容 #使用&组合内容和变量
```
```
ALERT 输出内容
```
例：
```
$a = 1
PRINT 产生了 & $a & 个对象。
>产生了1个对象。
```

兼容函数：#V1虚拟机遗留指令，后续更新计划由库或ffi实现类似功能
>rand、bool等

>考虑使用ffi扩充脚本函数库功能，如XoroshiroRNG算法等
